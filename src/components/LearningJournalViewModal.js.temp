import React, { useState, useEffect } from 'react';
import { db } from '../firebase';
import { collection, getDocs, doc, updateDoc } from 'firebase/firestore';

const STUDENTS = [
  'ê¹€ê·œë¯¼', 'ê¹€ë²”ì¤€', 'ê¹€ì„±ì¤€', 'ê¹€ìˆ˜ê²¸', 'ê¹€ì£¼ì›', 'ë¬¸ê¸°í›ˆ', 'ë°•ë™í•˜', 'ë°±ì£¼ì›',
  'ë°±ì§€ì›', 'ì†ì •í™˜', 'ì´ë„ìœ¤', 'ì´ì˜ˆì¤€', 'ì„ì¬í¬', 'ì¡°ì€ë¹ˆ', 'ì¡°ì°¬í¬', 'ìµœì„œìœ¤',
  'ìµœì„œí˜„', 'í•œì„œìš°', 'í™©ë¦¬ì•„', 'ê¹€ì£¼í•˜', 'ì´í•´ì›', 'í•˜ì§€ìˆ˜', 'í…ŒìŠ¤íŠ¸'
];

const PERIODS = ['1êµì‹œ', '2êµì‹œ', '3êµì‹œ', '4êµì‹œ', '5êµì‹œ', '6êµì‹œ', 'ê¸°íƒ€ êµì‹œ'];

const LearningJournalViewModal = ({ isOpen, onClose, selectedDate, refreshData }) => {
  const [data, setData] = useState([]);
  const [loading, setLoading] = useState(false);
  const [draggedEntry, setDraggedEntry] = useState(null);

  // ì ìˆ˜ì— ë”°ë¥¸ ìƒ‰ìƒ ê³„ì‚° í•¨ìˆ˜
  const getScoreColor = (score, type) => {
    const numScore = parseFloat(score);
    if (type === 'understanding') {
      // ì´í•´ë„: 1ì (ë¹¨ê°•) -> 5ì (ì´ˆë¡)
      if (numScore >= 4.5) return '#2e7d32'; // ì§„í•œ ì´ˆë¡
      if (numScore >= 3.5) return '#4caf50'; // ì´ˆë¡
      if (numScore >= 2.5) return '#8bc34a'; // ì—°í•œ ì´ˆë¡
      if (numScore >= 1.5) return '#ff9800'; // ì£¼í™©
      return '#f44336'; // ë¹¨ê°•
    } else {
      // ë§Œì¡±ë„: 1ì (ë¹¨ê°•) -> 5ì (ë¶„í™/ë¹¨ê°• ê³„ì—´)
      if (numScore >= 4.5) return '#c62828'; // ì§„í•œ ë¹¨ê°•
      if (numScore >= 3.5) return '#e53935'; // ë¹¨ê°•
      if (numScore >= 2.5) return '#ef5350'; // ì—°í•œ ë¹¨ê°•
      if (numScore >= 1.5) return '#ff7043'; // ì£¼í™©ë¹¨ê°•
      return '#ff8a65'; // ì—°í•œ ì£¼í™©ë¹¨ê°•
    }
  };
  const [availablePeriods, setAvailablePeriods] = useState([...PERIODS]);
  const [showMoveConfirmation, setShowMoveConfirmation] = useState(false);
  const [pendingMove, setPendingMove] = useState(null);
  const [showEmptyStudents, setShowEmptyStudents] = useState(true);
  const [showCompletedOnly, setShowCompletedOnly] = useState(false);
  const [selectedPeriodFilter, setSelectedPeriodFilter] = useState('ì „ì²´');
  const [selectedDateFilter, setSelectedDateFilter] = useState(new Date().toISOString().split('T')[0]); // íŠ¹ì • ë‚ ì§œ í•„í„°
  const [dragOverCell, setDragOverCell] = useState(null); // ë“œë˜ê·¸ í˜¸ë²„ ì¤‘ì¸ ì…€

  const fetchData = async () => {
    setLoading(true);
    try {
      let journals = [];
      
      if (selectedDate) {
        const dateStr = selectedDate.toISOString().split('T')[0];
        try {
          const dayQuery = collection(db, `journals/${dateStr}/entries`);
          const daySnapshot = await getDocs(dayQuery);
          
          daySnapshot.forEach(doc => {
            journals.push({
              id: doc.id,
              date: dateStr,
              ...doc.data()
            });
          });
        } catch (error) {
          console.log(`${dateStr} ë°ì´í„° ì—†ìŒ`);
        }
      } else {
        // ìµœê·¼ 30ì¼ê°„ì˜ ë°ì´í„° ì¡°íšŒ
        const today = new Date();
        
        for (let i = 0; i < 30; i++) {
          const d = new Date(today);
          d.setDate(d.getDate() - i);
          const dateStr = d.toISOString().split('T')[0];
          
          try {
            const dayQuery = collection(db, `journals/${dateStr}/entries`);
            const daySnapshot = await getDocs(dayQuery);
            
            daySnapshot.forEach(doc => {
              journals.push({
                id: doc.id,
                date: dateStr,
                ...doc.data()
              });
            });
          } catch (error) {
            // ì¡°ìš©íˆ ë¬´ì‹œ
          }
        }
      }

      journals.sort((a, b) => {
        const dateA = a.createdAt?.toDate?.() || new Date(a.date);
        const dateB = b.createdAt?.toDate?.() || new Date(b.date);
        return dateB - dateA;
      });
      
      setData(journals);
      
      // ëª¨ë“  êµì‹œë¥¼ í•­ìƒ í‘œì‹œ (ë°ì´í„°ê°€ ì—†ì–´ë„)
      setAvailablePeriods([...PERIODS]);
      
    } catch (error) {
      console.error('ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ì˜¤ë¥˜:', error);
    }
    setLoading(false);
  };

  useEffect(() => {
    if (isOpen) {
      fetchData();
    }
  }, [isOpen, selectedDate]);

  const handleMoveEntry = async (entry, newPeriod, skipRefresh = false) => {
    try {
      await updateDoc(doc(db, `journals/${entry.date}/entries`, entry.id), {
        period: newPeriod
      });
      
      if (!skipRefresh) {
        // ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸: ë¡œì»¬ ë°ì´í„° ìˆ˜ì •
        setData(prevData => 
          prevData.map(item => 
            item.id === entry.id 
              ? { ...item, period: newPeriod }
              : item
          )
        );
      }
      
      if (refreshData) refreshData();
    } catch (error) {
      console.error('êµì‹œ ì´ë™ ì˜¤ë¥˜:', error);
      alert('êµì‹œ ì´ë™ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
    }
  };

  const handleDragStart = (e, entry) => {
    setDraggedEntry({ ...entry, originalPeriod: entry.period });
    // ë” ë§¤ë„ëŸ¬ìš´ ë“œë˜ê·¸ íš¨ê³¼
    e.target.style.opacity = '0.7';
    e.target.style.transform = 'rotate(3deg) scale(1.05)';
    e.target.style.transition = 'all 0.2s ease';
    e.target.style.cursor = 'grabbing';
    e.target.style.zIndex = '1000';
  };

  const handleDragEnd = (e) => {
    e.target.style.opacity = '1';
    e.target.style.transform = 'rotate(0deg) scale(1)';
    e.target.style.cursor = 'move';
    e.target.style.zIndex = 'auto';
    setDraggedEntry(null);
    setDragOverCell(null);
  };

  const handleDragOver = (e) => {
    e.preventDefault();
  };

  const handleDragEnter = (e, period, studentName) => {
    e.preventDefault();
    if (draggedEntry && draggedEntry.studentName === studentName) {
      setDragOverCell(`${studentName}-${period}`);
    }
  };

  const handleDragLeave = (e) => {
    e.preventDefault();
    // ì…€ì„ ì™„ì „íˆ ë²—ì–´ë‚¬ì„ ë•Œë§Œ ë¦¬ì…‹
    if (!e.currentTarget.contains(e.relatedTarget)) {
      setDragOverCell(null);
    }
  };

  const handleDrop = (e, targetPeriod, targetStudent) => {
    e.preventDefault();
    
    if (!draggedEntry || targetPeriod === draggedEntry.originalPeriod) {
      return;
    }
    
    // ê°™ì€ í•™ìƒì˜ ë°ì´í„°ë§Œ ì´ë™ ê°€ëŠ¥
    if (draggedEntry.studentName !== targetStudent) {
      alert(`âš ï¸ ${draggedEntry.studentName}ì˜ ë°ì´í„°ëŠ” ë‹¤ë¥¸ í•™ìƒ í–‰ìœ¼ë¡œ ì´ë™í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`);
      return;
    }
    
    // í•´ë‹¹ êµì‹œì— ì´ë¯¸ ë°ì´í„°ê°€ ìˆëŠ”ì§€ í™•ì¸
    const existingEntry = data.find(entry => 
      entry.studentName === targetStudent && entry.period === targetPeriod
    );
    
    if (existingEntry) {
      // ë®ì–´ì“°ê¸° í™•ì¸
      setPendingMove({ 
        draggedEntry, 
        targetPeriod, 
        targetStudent, 
        existingEntry,
        isOverwrite: true
      });
      setShowMoveConfirmation(true);
    } else {
      // ë¹ˆ ì¹¸ìœ¼ë¡œ ì´ë™ - í™•ì¸ ëª¨ë‹¬ í‘œì‹œ
      setPendingMove({ 
        draggedEntry, 
        targetPeriod, 
        targetStudent, 
        existingEntry: null,
        isOverwrite: false
      });
      setShowMoveConfirmation(true);
    }
  };

  const confirmMove = async () => {
    if (pendingMove) {
      await handleMoveEntry(pendingMove.draggedEntry, pendingMove.targetPeriod);
    }
    setShowMoveConfirmation(false);
    setPendingMove(null);
  };

  const cancelMove = () => {
    setShowMoveConfirmation(false);
    setPendingMove(null);
  };

  if (!isOpen) return null;

  return (
    <>
      <div style={{
        position: 'fixed',
        top: 0,
        left: 0,
        right: 0,
        bottom: 0,
        backgroundColor: 'rgba(0, 0, 0, 0.5)',
        display: 'flex',
        alignItems: 'center',
        justifyContent: 'center',
        zIndex: 10000
      }}>
        <div style={{
          backgroundColor: 'white',
          borderRadius: '12px',
          maxWidth: '98vw',
          maxHeight: '95vh',
          width: '1932px',
          overflow: 'hidden',
          boxShadow: '0 20px 40px rgba(0, 0, 0, 0.3)'
        }}>
        {/* í—¤ë” */}
        <div style={{
          padding: '24px',
          borderBottom: '1px solid #e8eaed',
          display: 'flex',
          justifyContent: 'space-between',
          alignItems: 'center'
        }}>
          <div style={{ display: 'flex', alignItems: 'center', gap: '20px' }}>
            <h2 style={{ fontSize: '24px', fontWeight: 'bold', color: '#333', margin: 0 }}>
              ğŸ“š í•™ìŠµì¼ì§€ ì¡°íšŒ ğŸ­
            </h2>
            
            {/* íŠ¹ì •ì¼ ê³ ë¥´ê¸° ìº˜ë¦°ë” */}
            <div style={{ display: 'flex', alignItems: 'center', gap: '12px' }}>
              <label style={{ fontSize: '14px', fontWeight: '600', color: '#666' }}>
                ğŸ“… íŠ¹ì •ì¼ ë³´ê¸°:
              </label>
              <input
                type="date"
                value={selectedDateFilter || ''}
                onChange={(e) => {
                  const selectedValue = e.target.value;
                  setSelectedDateFilter(selectedValue || null);
                }}
                max={new Date().toISOString().split('T')[0]} // ì˜¤ëŠ˜ê¹Œì§€ë§Œ ì„ íƒ ê°€ëŠ¥
                min={new Date(Date.now() - 30 * 24 * 60 * 60 * 1000).toISOString().split('T')[0]} // 30ì¼ ì „ë¶€í„°
                style={{
                  padding: '8px 12px',
                  border: '2px solid #e1e5e9',
                  borderRadius: '8px',
                  fontSize: '13px',
                  backgroundColor: 'white',
                  cursor: 'pointer',
                  transition: 'all 0.2s ease'
                }}
                onFocus={(e) => {
                  e.target.style.borderColor = '#4285f4';
                  e.target.style.boxShadow = '0 0 0 2px rgba(66, 133, 244, 0.2)';
                }}
                onBlur={(e) => {
                  e.target.style.borderColor = '#e1e5e9';
                  e.target.style.boxShadow = 'none';
                }}
              />
              {selectedDateFilter && (
                <button
                  onClick={() => setSelectedDateFilter(null)}
                  style={{
                    padding: '6px 12px',
                    backgroundColor: '#f1f3f4',
                    border: '1px solid #dadce0',
                    borderRadius: '6px',
                    fontSize: '12px',
                    cursor: 'pointer',
                    color: '#5f6368',
                    transition: 'all 0.2s ease'
                  }}
                  onMouseOver={(e) => {
                    e.target.style.backgroundColor = '#e8eaed';
                  }}
                  onMouseOut={(e) => {
                    e.target.style.backgroundColor = '#f1f3f4';
                  }}
                >
                  ğŸ—‘ï¸ ì „ì²´ ë³´ê¸°
                </button>
              )}
            </div>
          </div>
          
          <button
            onClick={onClose}
            style={{
              background: 'none',
              border: 'none',
              fontSize: '24px',
              cursor: 'pointer',
              color: '#666'
            }}
          >
            âœ•
          </button>
        </div>

        {/* ë·° ëª¨ë“œ ì„ íƒ */}
        <div style={{
          padding: '16px 24px',
          borderBottom: '1px solid #e8eaed',
          display: 'flex',
          justifyContent: 'space-between',
          alignItems: 'center'
        }}>
          <div style={{ display: 'flex', gap: '8px' }}>
            <button
              style={{
                padding: '8px 16px',
                borderRadius: '8px',
                border: 'none',
                backgroundColor: 'transparent',
                color: '#666',
                fontSize: '14px',
                fontWeight: '600',
                cursor: 'pointer',
                transition: 'all 0.2s'
              }}
            >
              ğŸ“‹ ë¦¬ìŠ¤íŠ¸ ë³´ê¸°
            </button>
            <button
              style={{
                padding: '8px 16px',
                borderRadius: '8px',
                border: 'none',
                backgroundColor: '#4285f4',
                color: 'white',
                fontSize: '14px',
                fontWeight: '600',
                cursor: 'pointer',
                transition: 'all 0.2s'
              }}
            >
              ğŸ“Š í…Œì´ë¸” ë³´ê¸°
            </button>
          </div>
          <div style={{ display: 'flex', gap: '8px' }}>
            <button style={{
              padding: '8px 16px',
              borderRadius: '8px',
              border: 'none',
              backgroundColor: '#34A853',
              color: 'white',
              fontSize: '12px',
              fontWeight: '600',
              cursor: 'pointer'
            }}>
              ğŸ“Š CSV ë‹¤ìš´ë¡œë“œ
            </button>
            <button style={{
              padding: '8px 16px',
              borderRadius: '8px',
              border: 'none',
              backgroundColor: '#EA4335',
              color: 'white',
              fontSize: '12px',
              fontWeight: '600',
              cursor: 'pointer'
            }}>
              ğŸ“„ PDF ë‹¤ìš´ë¡œë“œ
            </button>
          </div>
        </div>

        {/* ì»¨í…ì¸  ì˜ì—­ */}
        <div style={{ maxHeight: '60vh', overflowY: 'auto', padding: '24px' }}>
          {loading ? (
            <div style={{ textAlign: 'center', padding: '40px', color: '#666' }}>
              ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
            </div>
          ) : data.length === 0 ? (
            <div style={{ textAlign: 'center', padding: '40px', color: '#666' }}>
              <div style={{ marginBottom: '16px' }}><img src="/lv2.png" alt="journal" style={{ width: '48px', height: '48px' }} /></div>
              <h3 style={{ color: '#333', marginBottom: '8px' }}>
                í•™ìŠµì¼ì§€ê°€ ì—†ìŠµë‹ˆë‹¤
              </h3>
              <p style={{ color: '#666', fontSize: '14px' }}>
                {selectedDate 
                  ? `${selectedDate.toLocaleDateString('ko-KR')}ì— ì‘ì„±ëœ í•™ìŠµì¼ì§€ê°€ ì—†ìŠµë‹ˆë‹¤.`
                  : 'ì‘ì„±ëœ í•™ìŠµì¼ì§€ê°€ ì—†ìŠµë‹ˆë‹¤.'
                }
              </p>
            </div>
          ) : (
            <div>
              <div style={{
                display: 'flex',
                justifyContent: 'space-between',
                alignItems: 'center',
                marginBottom: '20px'
              }}>
                <h3 style={{
                  fontSize: '18px',
                  fontWeight: 'bold',
                  color: '#202124',
                  margin: 0
                }}>
                  ğŸ“Š í•™ìŠµë°ì´í„° ({
                    selectedDateFilter ? 
                      data.filter(entry => entry.date === selectedDateFilter).length :
                      data.length
                  }ê°œ)
                </h3>
                
                {/* í•„í„° ì˜µì…˜ */}
                <div style={{
                  display: 'flex',
                  gap: '12px',
                  alignItems: 'center'
                }}>
                  {/* êµì‹œ í•„í„° */}
                  <select
                    value={selectedPeriodFilter}
                    onChange={(e) => setSelectedPeriodFilter(e.target.value)}
                    style={{
                      padding: '6px 12px',
                      border: '1px solid #ddd',
                      borderRadius: '6px',
                      fontSize: '13px',
                      backgroundColor: 'white',
                      cursor: 'pointer',
                      outline: 'none'
                    }}
                  >
                    <option value="ì „ì²´">ğŸ“š ì „ì²´</option>
                    {availablePeriods.map(period => (
                      <option key={period} value={period}>
                        ğŸ• {period}
                      </option>
                    ))}
                    <option value="ì‘ì„±ëœêµì‹œ">âœï¸ ì‘ì„±ëœ êµì‹œ</option>
                  </select>

                  <label style={{
                    display: 'flex',
                    alignItems: 'center',
                    gap: '6px',
                    fontSize: '13px',
                    color: '#666',
                    cursor: 'pointer'
                  }}>
                    <input
                      type="checkbox"
                      checked={showEmptyStudents}
                      onChange={(e) => setShowEmptyStudents(e.target.checked)}
                      style={{
                        width: '14px',
                        height: '14px',
                        cursor: 'pointer'
                      }}
                    />
                    ë¹ˆ í•™ìƒ í‘œì‹œ
                  </label>
                </div>
              </div>
              
              {/* ë‚ ì§œë³„ í…Œì´ë¸” ë·° */}
              <div style={{ overflowX: 'auto' }}>
                {(() => {
                  // ë‚ ì§œë³„ë¡œ ë°ì´í„° ê·¸ë£¹í•‘
                  const dataByDate = {};
                  data.forEach(entry => {
                    if (!dataByDate[entry.date]) {
                      dataByDate[entry.date] = [];
                    }
                    dataByDate[entry.date].push(entry);
                  });
                  
                  // ì˜¤ëŠ˜ ë‚ ì§œ ìë™ ì¶”ê°€ (ë°ì´í„°ê°€ ì—†ì–´ë„ ë¹ˆ í…Œì´ë¸” í‘œì‹œ)
                  const today = new Date().toISOString().split('T')[0];
                  if (!dataByDate[today]) {
                    dataByDate[today] = [];
                  }
                  
                  // ì–´ì œ ë‚ ì§œë„ ì¶”ê°€ (í•„ìš”í•œ ê²½ìš°)
                  const yesterday = new Date(Date.now() - 24 * 60 * 60 * 1000).toISOString().split('T')[0];
                  if (!dataByDate[yesterday]) {
                    dataByDate[yesterday] = [];
                  }
                  
                  // ë‚ ì§œ ìˆœìœ¼ë¡œ ì •ë ¬ (ìµœì‹  ìˆœ)
                  const sortedDates = Object.keys(dataByDate).sort((a, b) => new Date(b) - new Date(a));
                  
                  if (sortedDates.length === 0) {
                    return (
                      <div style={{
                        textAlign: 'center',
                        padding: '60px 20px',
                        color: '#666',
                        backgroundColor: '#f8f9fa',
                        borderRadius: '12px',
                        border: '2px dashed #ddd'
                      }}>
                        <div style={{ marginBottom: '16px' }}><img src="/lv3.png" alt="no data" style={{ width: '48px', height: '48px' }} /></div>
                        <div style={{ fontSize: '18px', fontWeight: 'bold', marginBottom: '8px' }}>
                          í•™ìŠµì¼ì§€ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤
                        </div>
                        <div style={{ fontSize: '14px', color: '#999' }}>
                          ì„ íƒí•œ ë‚ ì§œì— ì‘ì„±ëœ í•™ìŠµì¼ì§€ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
                        </div>
                      </div>
                    );
                  }
                  
                  // ë‚ ì§œ í•„í„° ì ìš©
                  const filteredDates = selectedDateFilter ? 
                    sortedDates.filter(date => date === selectedDateFilter) : 
                    sortedDates;
                  
                  return filteredDates.map((date, dateIndex) => {
                    const dateEntries = dataByDate[date];
                    const formattedDate = new Date(date).toLocaleDateString('ko-KR', {
                      year: 'numeric',
                      month: 'long', 
                      day: 'numeric',
                      weekday: 'long'
                    });
                    
                    return (
                      <div key={date} style={{ 
                        marginBottom: dateIndex === filteredDates.length - 1 ? '0' : '40px',
                        boxShadow: '0 4px 16px rgba(0,0,0,0.1)',
                        borderRadius: '16px',
                        overflow: 'hidden',
                        backgroundColor: 'white'
                      }}>
                        {/* ë‚ ì§œ í—¤ë” */}
                        <div style={{
                          padding: '20px 24px',
                          background: 'linear-gradient(135deg, #1a73e8 0%, #4285f4 50%, #34a853 100%)',
                          color: 'white',
                          fontSize: '20px',
                          fontWeight: 'bold',
                          display: 'flex',
                          alignItems: 'center',
                          gap: '12px',
                          position: 'relative',
                          overflow: 'hidden'
                        }}>
                          <div style={{
                            position: 'absolute',
                            top: 0,
                            left: 0,
                            right: 0,
                            bottom: 0,
                            background: 'linear-gradient(45deg, rgba(255,255,255,0.1) 25%, transparent 25%, transparent 50%, rgba(255,255,255,0.1) 50%, rgba(255,255,255,0.1) 75%, transparent 75%)',
                            backgroundSize: '20px 20px'
                          }} />
                          <span style={{ position: 'relative', zIndex: 1 }}>ğŸ“… {formattedDate}</span>
                          
                          {/* ë‚ ì§œ í•„í„° ë²„íŠ¼ */}
                          <button
                            onClick={() => {
                              setSelectedDateFilter(selectedDateFilter === date ? null : date);
                            }}
                            style={{
                              backgroundColor: selectedDateFilter === date ? 'rgba(255,255,255,0.4)' : 'rgba(255,255,255,0.25)',
                              border: selectedDateFilter === date ? '2px solid rgba(255,255,255,0.8)' : '2px solid transparent',
                              color: 'white',
                              padding: '6px 12px',
                              borderRadius: '20px',
                              fontSize: '12px',
                              fontWeight: '600',
                              cursor: 'pointer',
                              transition: 'all 0.2s ease',
                              position: 'relative',
                              zIndex: 1,
                              display: 'flex',
                              alignItems: 'center',
                              gap: '4px'
                            }}
                            onMouseOver={(e) => {
                              if (selectedDateFilter !== date) {
                                e.target.style.backgroundColor = 'rgba(255,255,255,0.35)';
                              }
                            }}
                            onMouseOut={(e) => {
                              if (selectedDateFilter !== date) {
                                e.target.style.backgroundColor = 'rgba(255,255,255,0.25)';
                              }
                            }}
                          >
                            ğŸ“… {selectedDateFilter === date ? 'ì „ì²´ ë³´ê¸°' : 'ì´ ë‚ ë§Œ ë³´ê¸°'}
                          </button>
                          
                          <div style={{
                            marginLeft: 'auto',
                            backgroundColor: dateEntries.length === 0 ? 'rgba(255,193,7,0.3)' : 'rgba(255,255,255,0.25)',
                            padding: '8px 16px',
                            borderRadius: '20px',
                            fontSize: '14px',
                            fontWeight: '600',
                            position: 'relative',
                            zIndex: 1,
                            border: dateEntries.length === 0 ? '2px solid rgba(255,255,255,0.5)' : 'none'
                          }}>
                            {dateEntries.length === 0 ? (
                              <div style={{ display: 'flex', alignItems: 'center', gap: '4px' }}>
                                <img src="/lv4.png" alt="waiting" style={{ width: '16px', height: '16px' }} />
                                <span>ì‘ì„± ëŒ€ê¸° ì¤‘</span>
                              </div>
                            ) : (
                              <div style={{ display: 'flex', alignItems: 'center', gap: '4px' }}>
                                <img src="/lv5.png" alt="completed" style={{ width: '16px', height: '16px' }} />
                                <span>ì´ {dateEntries.length}ê°œ ì‘ì„±</span>
                              </div>
                            )}
                          </div>
                        </div>
                        
                        {/* í•´ë‹¹ ë‚ ì§œ í…Œì´ë¸” */}
                        <table style={{
                          width: '100%',
                          borderCollapse: 'collapse',
                          fontSize: '14px',
                          backgroundColor: 'white'
                        }}>
                          <thead>
                            <tr>
                              <th style={{ 
                                padding: '16px 20px', 
                                border: '1px solid #e8eaed', 
                                backgroundColor: '#34a853',
                                color: 'white',
                                fontWeight: 'bold',
                                width: '140px',
                                textAlign: 'center',
                                fontSize: '15px'
                              }}>
                                ğŸ‘¤ í•™ìƒëª…
                              </th>
                              {(() => {
                                // í•„í„°ì— ë”°ë¼ í‘œì‹œí•  êµì‹œ ê²°ì •
                                let periodsToShow = availablePeriods;
                                if (selectedPeriodFilter === 'ì‘ì„±ëœêµì‹œ') {
                                  periodsToShow = [...new Set(dateEntries.map(entry => entry.period).filter(Boolean))];
                                } else if (selectedPeriodFilter !== 'ì „ì²´') {
                                  periodsToShow = [selectedPeriodFilter];
                                }
                                return periodsToShow.map(period => (
                                  <th
                                    key={period}
                                    style={{
                                      padding: '16px 20px',
                                      border: '1px solid #e8eaed',
                                      backgroundColor: '#34a853',
                                      color: 'white',
                                      fontWeight: 'bold',
                                      minWidth: '220px',
                                      textAlign: 'center',
                                      fontSize: '15px'
                                    }}
                                  >
                                    ğŸ• {period}
                                  </th>
                                ));
                              })()}
                            </tr>
                          </thead>
                          <tbody>
                            {STUDENTS.filter(studentName => {
                              const studentEntries = dateEntries.filter(entry => entry.studentName === studentName);
                              
                              // ë¹ˆ í•™ìƒ ìˆ¨ê¸°ê¸° ì˜µì…˜
                              if (!showEmptyStudents && studentEntries.length === 0) {
                                return false;
                              }
                              
                              return true;
                            }).map((studentName, studentIndex, filteredStudents) => {
                              const studentEntries = dateEntries.filter(entry => entry.studentName === studentName);
                              const isLastRow = studentIndex === filteredStudents.length - 1;
                              
                              return (
                                <tr key={`${date}-${studentName}`} style={{
                                  backgroundColor: studentIndex % 2 === 0 ? '#fafafa' : 'white'
                                }}>
                                  <td style={{ 
                                    padding: '16px 20px', 
                                    border: `1px solid #e8eaed${isLastRow ? '' : ''}`,
                                    fontWeight: 'bold',
                                    backgroundColor: studentEntries.length > 0 ? '#e8f5e8' : '#f5f5f5',
                                    textAlign: 'center',
                                    width: '140px',
                                    verticalAlign: 'top',
                                    borderBottom: isLastRow ? 'none' : '1px solid #e8eaed',
                                    whiteSpace: 'nowrap'
                                  }}>
                                    <div style={{
                                      display: 'flex',
                                      alignItems: 'center',
                                      justifyContent: 'center',
                                      gap: '8px'
                                    }}>
                                      <img src="/lv1.png" alt="student" style={{ width: '16px', height: '16px' }} /> <span style={{ fontSize: '14px' }}>{studentName}</span>
                                    </div>
                                  </td>
                                  {(() => {
                                    // í•„í„°ì— ë”°ë¼ í‘œì‹œí•  êµì‹œ ê²°ì •
                                    let periodsToShow = availablePeriods;
                                    if (selectedPeriodFilter === 'ì‘ì„±ëœêµì‹œ') {
                                      periodsToShow = [...new Set(dateEntries.map(entry => entry.period).filter(Boolean))];
                                    } else if (selectedPeriodFilter !== 'ì „ì²´') {
                                      periodsToShow = [selectedPeriodFilter];
                                    }
                                    return periodsToShow.map((period, periodIndex) => {
                                      const entry = studentEntries.find(e => e.period === period);
                                      const isLastColumn = periodIndex === periodsToShow.length - 1;
                                      
                                      return (
                                      <td
                                        key={period}
                                        onDragOver={handleDragOver}
                                        onDragEnter={(e) => handleDragEnter(e, period, studentName)}
                                        onDragLeave={handleDragLeave}
                                        onDrop={(e) => handleDrop(e, period, studentName)}
                                        style={{
                                          padding: '12px',
                                          border: '1px solid #e8eaed',
                                          verticalAlign: 'top',
                                          borderRight: isLastColumn ? 'none' : '1px solid #e8eaed',
                                          borderBottom: isLastRow ? 'none' : '1px solid #e8eaed',
                                          // ë“œë˜ê·¸ ì˜¤ë²„ ì‹œ ì‹œê°ì  íš¨ê³¼
                                          backgroundColor: dragOverCell === `${studentName}-${period}` ? 
                                            (entry ? 'rgba(255, 235, 59, 0.3)' : 'rgba(33, 150, 243, 0.15)') : 
                                            'transparent',
                                          transition: 'background-color 0.2s ease, transform 0.2s ease',
                                          transform: dragOverCell === `${studentName}-${period}` ? 'scale(1.02)' : 'scale(1)',
                                          boxShadow: dragOverCell === `${studentName}-${period}` ? 
                                            '0 4px 12px rgba(0,0,0,0.15)' : 'none'
                                        }}
                                      >
                                        {entry ? (
                                          <div
                                            draggable
                                            onDragStart={(e) => handleDragStart(e, entry)}
                                            onDragEnd={handleDragEnd}
                                            style={{
                                              padding: '16px',
                                              backgroundColor: '#e8f5e8',
                                              border: '2px solid #34a853',
                                              borderRadius: '12px',
                                              cursor: 'move',
                                              fontSize: '13px',
                                              transition: 'all 0.3s ease',
                                              boxShadow: '0 3px 6px rgba(52, 168, 83, 0.2)',
                                              minHeight: '120px',
                                              position: 'relative'
                                            }}
                                            onMouseOver={(e) => {
                                              if (!draggedEntry) {
                                                e.currentTarget.style.transform = 'translateY(-2px) scale(1.02)';
                                                e.currentTarget.style.boxShadow = '0 6px 12px rgba(52, 168, 83, 0.3)';
                                                e.currentTarget.style.cursor = 'grab';
                                              }
                                            }}
                                            onMouseOut={(e) => {
                                              if (!draggedEntry) {
                                                e.currentTarget.style.transform = 'translateY(0) scale(1)';
                                                e.currentTarget.style.boxShadow = '0 3px 6px rgba(52, 168, 83, 0.2)';
                                                e.currentTarget.style.cursor = 'move';
                                              }
                                            }}
                                          >
                                            {/* ì ìˆ˜ í‘œì‹œ */}
                                            <div style={{ 
                                              display: 'flex', 
                                              gap: '10px', 
                                              marginBottom: '12px',
                                              justifyContent: 'space-between'
                                            }}>
                                              <span style={{ 
                                                fontSize: '12px', 
                                                fontWeight: 'bold',
                                                color: getScoreColor(entry.understanding, 'understanding'),
                                                backgroundColor: 'white',
                                                padding: '4px 10px',
                                                borderRadius: '15px',
                                                border: `2px solid ${getScoreColor(entry.understanding, 'understanding')}`,
                                                boxShadow: '0 2px 4px rgba(0,0,0,0.1)'
                                              }}>
                                                ğŸŸ¢ {entry.understanding}ì 
                                              </span>
                                              <span style={{ 
                                                fontSize: '12px', 
                                                fontWeight: 'bold',
                                                color: getScoreColor(entry.satisfaction, 'satisfaction'),
                                                backgroundColor: 'white',
                                                padding: '4px 10px',
                                                borderRadius: '15px',
                                                border: `2px solid ${getScoreColor(entry.satisfaction, 'satisfaction')}`,
                                                boxShadow: '0 2px 4px rgba(0,0,0,0.1)'
                                              }}>
                                                â¤ï¸ {entry.satisfaction}ì 
                                              </span>
                                            </div>

                                            {/* í‚¤ì›Œë“œ ì„¹ì…˜ */}
                                            {entry.keyword && (
                                              <div style={{ 
                                                marginBottom: '10px', 
                                                fontSize: '13px',
                                                backgroundColor: '#fff8e1',
                                                padding: '8px 12px',
                                                borderRadius: '8px',
                                                border: '2px solid #ffc107',
                                                boxShadow: '0 2px 4px rgba(255, 193, 7, 0.2)'
                                              }}>
                                                <span style={{ fontWeight: 'bold', color: '#f57c00' }}>
                                                  ğŸ”‘ {entry.keyword}
                                                </span>
                                              </div>
                                            )}
                                            
                                            {/* í•™ìŠµ ë‚´ìš© ì„¹ì…˜ */}
                                            <div style={{ 
                                              fontSize: '12px', 
                                              color: '#444',
                                              backgroundColor: 'white',
                                              padding: '10px 12px',
                                              borderRadius: '8px',
                                              border: '1px solid #ddd',
                                              lineHeight: '1.5',
                                              minHeight: '50px',
                                              boxShadow: 'inset 0 1px 3px rgba(0,0,0,0.1)'
                                            }}>
                                              <div style={{ display: 'flex', alignItems: 'flex-start', gap: '6px' }}>
                                                <img src="/lv6.png" alt="content" style={{ width: '14px', height: '14px', marginTop: '2px' }} />
                                                <span style={{ fontWeight: '500' }}>
                                                  {entry.content ? 
                                                    entry.content.substring(0, 80) + (entry.content.length > 80 ? '...' : '') 
                                                    : 'ë‚´ìš© ì—†ìŒ'
                                                  }
                                                </span>
                                              </div>
                                            </div>
                                          </div>
                                        ) : (
                                          <div style={{ 
                                            color: dragOverCell === `${studentName}-${period}` ? '#1976d2' : '#999', 
                                            textAlign: 'center', 
                                            padding: '24px 16px',
                                            border: dragOverCell === `${studentName}-${period}` ? 
                                              '3px solid #2196f3' : '2px dashed #ddd',
                                            borderRadius: '12px',
                                            backgroundColor: dragOverCell === `${studentName}-${period}` ? 
                                              '#e3f2fd' : '#fafafa',
                                            transition: 'all 0.2s ease',
                                            minHeight: '120px',
                                            display: 'flex',
                                            flexDirection: 'column',
                                            alignItems: 'center',
                                            justifyContent: 'center',
                                            fontSize: '13px',
                                            transform: dragOverCell === `${studentName}-${period}` ? 'scale(1.05)' : 'scale(1)',
                                            boxShadow: dragOverCell === `${studentName}-${period}` ? 
                                              '0 8px 16px rgba(33, 150, 243, 0.3)' : 'none'
                                          }}
                                          onMouseOver={(e) => {
                                            if (dragOverCell !== `${studentName}-${period}`) {
                                              e.currentTarget.style.backgroundColor = '#f0f8ff';
                                              e.currentTarget.style.borderColor = '#4285f4';
                                            }
                                          }}
                                          onMouseOut={(e) => {
                                            if (dragOverCell !== `${studentName}-${period}`) {
                                              e.currentTarget.style.backgroundColor = '#fafafa';
                                              e.currentTarget.style.borderColor = '#ddd';
                                            }
                                          }}
                                          >
                                            <div style={{ marginBottom: '8px' }}><img src="/lv7.png" alt="empty" style={{ width: '24px', height: '24px' }} /></div>
                                            <div style={{ fontWeight: '500', marginBottom: '4px' }}>ë¹ˆ ì¹¸</div>
                                            <div style={{ fontSize: '11px', color: '#ccc' }}>
                                              ë“œë˜ê·¸í•˜ì—¬ ì´ë™
                                            </div>
                                          </div>
                                        )}
                                      </td>
                                    );
                                    });
                                  })()}
                                </tr>
                              );
                            })}
                          </tbody>
                        </table>
                        
                        {/* ë¹ˆ í…Œì´ë¸” ì•ˆë‚´ ë©”ì‹œì§€ */}
                        {dateEntries.length === 0 && (
                          <div style={{
                            padding: '32px 24px',
                            textAlign: 'center',
                            backgroundColor: '#f8f9fa',
                            borderTop: '3px dashed #ddd'
                          }}>
                            <div style={{ marginBottom: '16px' }}><img src="/lv8.png" alt="no journal" style={{ width: '48px', height: '48px' }} /></div>
                            <div style={{ fontSize: '18px', fontWeight: 'bold', color: '#666', marginBottom: '8px' }}>
                              {date === new Date().toISOString().split('T')[0] ? 
                                'ì˜¤ëŠ˜ì˜ í•™ìŠµì¼ì§€ë¥¼ ì‘ì„±í•´ë³´ì„¸ìš”!' : 
                                'ì´ ë‚ ì˜ í•™ìŠµì¼ì§€ê°€ ì—†ìŠµë‹ˆë‹¤'
                              }
                            </div>
                            <div style={{ fontSize: '14px', color: '#999', lineHeight: '1.5' }}>
                              {date === new Date().toISOString().split('T')[0] ? 
                                'í•™ìƒë“¤ì´ í•™ìŠµì¼ì§€ë¥¼ ì‘ì„±í•˜ë©´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.\në“œë˜ê·¸ ì•¤ ë“œë¡­ìœ¼ë¡œ êµì‹œë¥¼ ì´ë™í•  ìˆ˜ë„ ìˆì–´ìš”!' :
                                'í•´ë‹¹ ë‚ ì§œì—ëŠ” ì‘ì„±ëœ í•™ìŠµì¼ì§€ê°€ ì—†ìŠµë‹ˆë‹¤.\në‹¤ë¥¸ ë‚ ì§œë¥¼ í™•ì¸í•´ë³´ì„¸ìš”.'
                              }
                            </div>
                          </div>
                        )}
                      </div>
                    );
                  });
                })()}
              </div>

              {/* êµì‹œë³„ í‰ê·  ë¶„ì„ */}
              <div style={{ marginTop: '32px' }}>
                <h3 style={{
                  fontSize: '18px',
                  fontWeight: 'bold',
                  color: '#202124',
                  marginBottom: '20px',
                  display: 'flex',
                  alignItems: 'center',
                  gap: '8px',
                  background: 'linear-gradient(135deg, #4285f4, #34a853)',
                  WebkitBackgroundClip: 'text',
                  WebkitTextFillColor: 'transparent'
                }}>
                  ğŸ“ˆ êµì‹œë³„ í‰ê·  ë¶„ì„
                </h3>
                
                <div style={{ 
                  display: 'grid', 
                  gridTemplateColumns: 'repeat(auto-fit, minmax(300px, 1fr))', 
                  gap: '20px'
                }}>
                  {(() => {
                    // í•„í„°ì— ë”°ë¼ í‘œì‹œí•  êµì‹œ ê²°ì •
                    let periodsToShow = availablePeriods;
                    if (selectedPeriodFilter === 'ì‘ì„±ëœêµì‹œ') {
                      periodsToShow = [...new Set(data.map(entry => entry.period).filter(Boolean))];
                    } else if (selectedPeriodFilter !== 'ì „ì²´') {
                      periodsToShow = [selectedPeriodFilter];
                    }
                    
                    return periodsToShow.map(period => {
                      // ë‚ ì§œ í•„í„° ì ìš©ëœ ë°ì´í„°ë§Œ ì‚¬ìš©
                      const filteredData = selectedDateFilter ? 
                        data.filter(entry => entry.date === selectedDateFilter) : 
                        data;
                      const periodEntries = filteredData.filter(entry => entry.period === period);
                      const avgUnderstanding = periodEntries.length > 0 
                        ? (periodEntries.reduce((sum, entry) => sum + (entry.understanding || 0), 0) / periodEntries.length).toFixed(1)
                        : '0.0';
                      const avgSatisfaction = periodEntries.length > 0 
                        ? (periodEntries.reduce((sum, entry) => sum + (entry.satisfaction || 0), 0) / periodEntries.length).toFixed(1)
                        : '0.0';
                      
                    
                    return (
                      <div key={period} style={{
                        backgroundColor: '#f8f9fa',
                        borderRadius: '12px',
                        padding: '16px',
                        border: '1px solid #e8eaed',
                        boxShadow: '0 2px 4px rgba(0,0,0,0.1)'
                      }}>
                        <h4 style={{
                          fontSize: '16px',
                          fontWeight: 'bold',
                          color: '#4285f4',
                          marginBottom: '12px',
                          textAlign: 'center'
                        }}>
                          ğŸ• {period}
                        </h4>
                        
                        {/* ì´í•´ë„ */}
                        <div style={{ marginBottom: '16px' }}>
                          <div style={{
                            display: 'flex',
                            justifyContent: 'space-between',
                            alignItems: 'center',
                            marginBottom: '6px'
                          }}>
                            <span style={{ fontSize: '13px', fontWeight: '500', color: '#34a853' }}>
                              ğŸŸ¢ ì´í•´ë„
                            </span>
                            <span style={{ fontSize: '16px', fontWeight: 'bold', color: '#34a853' }}>
                              {avgUnderstanding}ì 
                            </span>
                          </div>
                          <div style={{
                            height: '8px',
                            backgroundColor: '#e8f5e8',
                            borderRadius: '4px',
                            overflow: 'hidden'
                          }}>
                            <div style={{
                              width: `${(parseFloat(avgUnderstanding) / 5) * 100}%`,
                              height: '100%',
                              backgroundColor: getScoreColor(avgUnderstanding, 'understanding'),
                              borderRadius: '4px',
                              transition: 'width 0.3s ease'
                            }}></div>
                          </div>
                        </div>

                        {/* ë§Œì¡±ë„ */}
                        <div>
                          <div style={{
                            display: 'flex',
                            justifyContent: 'space-between',
                            alignItems: 'center',
                            marginBottom: '6px'
                          }}>
                            <span style={{ fontSize: '13px', fontWeight: '500', color: '#ea4335' }}>
                              â¤ï¸ ë§Œì¡±ë„
                            </span>
                            <span style={{ fontSize: '16px', fontWeight: 'bold', color: '#ea4335' }}>
                              {avgSatisfaction}ì 
                            </span>
                          </div>
                          <div style={{
                            height: '8px',
                            backgroundColor: '#fde8e8',
                            borderRadius: '4px',
                            overflow: 'hidden'
                          }}>
                            <div style={{
                              width: `${(parseFloat(avgSatisfaction) / 5) * 100}%`,
                              height: '100%',
                              backgroundColor: getScoreColor(avgSatisfaction, 'satisfaction'),
                              borderRadius: '4px',
                              transition: 'width 0.3s ease'
                            }}></div>
                          </div>
                        </div>

                        <div style={{
                          marginTop: '12px',
                          fontSize: '12px',
                          color: '#666',
                          textAlign: 'center',
                          backgroundColor: 'white',
                          padding: '6px',
                          borderRadius: '6px'
                        }}>
                          ğŸ‘¥ {periodEntries.length}ëª… ì°¸ì—¬
                        </div>
                      </div>
                      );
                    });
                  })()}
                </div>
              </div>

              {/* í†µê³„ ìš”ì•½ */}
              <div style={{ marginTop: '32px' }}>
                <h3 style={{
                  fontSize: '16px',
                  fontWeight: 'bold',
                  color: '#202124',
                  marginBottom: '16px',
                  display: 'flex',
                  alignItems: 'center',
                  gap: '8px'
                }}>
                  ğŸ“Š í†µê³„ ìš”ì•½
                </h3>
                <div style={{
                  display: 'grid',
                  gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))',
                  gap: '16px'
                }}>
                  {(() => {
                    // ë‚ ì§œ í•„í„° ì ìš©ëœ ë°ì´í„°ë§Œ ì‚¬ìš©
                    const statsData = selectedDateFilter ? 
                      data.filter(entry => entry.date === selectedDateFilter) : 
                      data;
                    
                    const avgUnderstanding = statsData.length > 0 ? 
                      (statsData.reduce((sum, entry) => sum + (entry.understanding || 0), 0) / statsData.length).toFixed(1) : '0.0';
                    const avgSatisfaction = statsData.length > 0 ? 
                      (statsData.reduce((sum, entry) => sum + (entry.satisfaction || 0), 0) / statsData.length).toFixed(1) : '0.0';
                    
                    return (
                      <>
                        <div style={{
                          padding: '16px',
                          backgroundColor: selectedDateFilter ? '#e3f2fd' : '#f8f9fa',
                          borderRadius: '8px',
                          border: selectedDateFilter ? '2px solid #2196f3' : '1px solid #e8eaed',
                          position: 'relative'
                        }}>
                          {selectedDateFilter && (
                            <div style={{
                              position: 'absolute',
                              top: '-8px',
                              right: '8px',
                              backgroundColor: '#2196f3',
                              color: 'white',
                              padding: '2px 8px',
                              borderRadius: '10px',
                              fontSize: '10px',
                              fontWeight: 'bold'
                            }}>
                              íŠ¹ì •ì¼
                            </div>
                          )}
                          <div style={{ fontSize: '24px', fontWeight: 'bold', color: '#1a73e8' }}>
                            {statsData.length}
                          </div>
                          <div style={{ fontSize: '12px', color: '#666' }}>
                            {selectedDateFilter ? 
                              `${new Date(selectedDateFilter).toLocaleDateString('ko-KR', { month: 'long', day: 'numeric' })} í•™ìŠµì¼ì§€ ìˆ˜` : 
                              'ì´ í•™ìŠµì¼ì§€ ìˆ˜'
                            }
                          </div>
                        </div>
                        <div style={{
                          padding: '16px',
                          backgroundColor: selectedDateFilter ? '#e8f5e8' : '#f8f9fa',
                          borderRadius: '8px',
                          border: selectedDateFilter ? '2px solid #4caf50' : '1px solid #e8eaed',
                          position: 'relative'
                        }}>
                          {selectedDateFilter && (
                            <div style={{
                              position: 'absolute',
                              top: '-8px',
                              right: '8px',
                              backgroundColor: '#4caf50',
                              color: 'white',
                              padding: '2px 8px',
                              borderRadius: '10px',
                              fontSize: '10px',
                              fontWeight: 'bold'
                            }}>
                              íŠ¹ì •ì¼
                            </div>
                          )}
                          <div style={{ fontSize: '24px', fontWeight: 'bold', color: '#34a853' }}>
                            {avgUnderstanding}ì 
                          </div>
                          <div style={{ fontSize: '12px', color: '#666' }}>
                            {selectedDateFilter ? 
                              `${new Date(selectedDateFilter).toLocaleDateString('ko-KR', { month: 'long', day: 'numeric' })} í‰ê·  ì´í•´ë„` : 
                              'ì „ì²´ í‰ê·  ì´í•´ë„'
                            }
                          </div>
                        </div>
                        <div style={{
                          padding: '16px',
                          backgroundColor: selectedDateFilter ? '#ffebee' : '#f8f9fa',
                          borderRadius: '8px',
                          border: selectedDateFilter ? '2px solid #f44336' : '1px solid #e8eaed',
                          position: 'relative'
                        }}>
                          {selectedDateFilter && (
                            <div style={{
                              position: 'absolute',
                              top: '-8px',
                              right: '8px',
                              backgroundColor: '#f44336',
                              color: 'white',
                              padding: '2px 8px',
                              borderRadius: '10px',
                              fontSize: '10px',
                              fontWeight: 'bold'
                            }}>
                              íŠ¹ì •ì¼
                            </div>
                          )}
                          <div style={{ fontSize: '24px', fontWeight: 'bold', color: '#ea4335' }}>
                            {avgSatisfaction}ì 
                          </div>
                          <div style={{ fontSize: '12px', color: '#666' }}>
                            {selectedDateFilter ? 
                              `${new Date(selectedDateFilter).toLocaleDateString('ko-KR', { month: 'long', day: 'numeric' })} í‰ê·  ë§Œì¡±ë„` : 
                              'ì „ì²´ í‰ê·  ë§Œì¡±ë„'
                            }
                          </div>
                        </div>
                      </>
                    );
                  })()}
                </div>
              </div>
            </div>
          )}
        </div>
      </div>
      </div>

      {/* ì´ë™ í™•ì¸ ëª¨ë‹¬ */}
      {showMoveConfirmation && (
        <div style={{
          position: 'fixed',
          top: 0,
          left: 0,
          right: 0,
          bottom: 0,
          backgroundColor: 'rgba(0, 0, 0, 0.7)',
          display: 'flex',
          alignItems: 'center',
          justifyContent: 'center',
          zIndex: 10001
        }}>
          <div style={{
            backgroundColor: 'white',
            borderRadius: '16px',
            padding: '32px',
            maxWidth: '500px',
            width: '90%',
            boxShadow: '0 20px 40px rgba(0, 0, 0, 0.3)'
          }}>
            <div style={{
              textAlign: 'center',
              marginBottom: '24px'
            }}>
              <div style={{ marginBottom: '16px' }}>
                <img src={pendingMove?.isOverwrite ? "/lv9.png" : "/lv10.png"} alt={pendingMove?.isOverwrite ? "warning" : "move"} style={{ width: '48px', height: '48px' }} />
              </div>
              <h3 style={{
                fontSize: '20px',
                fontWeight: 'bold',
                color: '#333',
                marginBottom: '8px'
              }}>
                {pendingMove?.isOverwrite ? 'ë°ì´í„° ë®ì–´ì“°ê¸° í™•ì¸' : 'ë°ì´í„° ì´ë™ í™•ì¸'}
              </h3>
              <p style={{ color: '#666', lineHeight: '1.5' }}>
                {pendingMove?.isOverwrite ? (
                  <>
                    <strong>{pendingMove?.targetPeriod}</strong>ì— ì´ë¯¸ ë°ì´í„°ê°€ ìˆìŠµë‹ˆë‹¤.<br/>
                    ê¸°ì¡´ ë°ì´í„°ë¥¼ ìƒˆ ë°ì´í„°ë¡œ êµì²´í•˜ì‹œê² ìŠµë‹ˆê¹Œ?
                  </>
                ) : (
                  <>
                    <strong>{pendingMove?.draggedEntry?.studentName}</strong>ë‹˜ì˜ ë°ì´í„°ë¥¼<br/>
                    <strong>{pendingMove?.targetPeriod}</strong>ë¡œ ì´ë™í•˜ì‹œê² ìŠµë‹ˆê¹Œ?
                  </>
                )}
              </p>
            </div>

            {pendingMove?.isOverwrite && (
              <div style={{
                display: 'grid',
                gridTemplateColumns: '1fr 1fr',
                gap: '16px',
                marginBottom: '16px'
              }}>
                <div style={{
                  padding: '16px',
                  backgroundColor: '#fef2f2',
                  borderRadius: '8px',
                  border: '1px solid #fecaca'
                }}>
                  <div style={{ fontSize: '12px', color: '#dc2626', fontWeight: 'bold', marginBottom: '8px' }}>
                    ì‚­ì œë  ë°ì´í„°
                  </div>
                  <div style={{ fontSize: '11px', color: '#666', lineHeight: '1.4' }}>
                    <div style={{ marginBottom: '4px' }}>
                      <strong>ì´í•´ë„:</strong> {pendingMove?.existingEntry?.understanding}ì 
                    </div>
                    <div style={{ marginBottom: '4px' }}>
                      <strong>ë§Œì¡±ë„:</strong> {pendingMove?.existingEntry?.satisfaction}ì 
                    </div>
                    {pendingMove?.existingEntry?.keyword && (
                      <div style={{ marginBottom: '4px' }}>
                        <strong>í‚¤ì›Œë“œ:</strong> {pendingMove.existingEntry.keyword}
                      </div>
                    )}
                    <div style={{ 
                      marginTop: '6px',
                      padding: '4px 6px',
                      backgroundColor: 'rgba(255,255,255,0.7)',
                      borderRadius: '4px',
                      fontSize: '10px'
                    }}>
                      <strong>ë‚´ìš©:</strong> {pendingMove?.existingEntry?.content 
                        ? (pendingMove.existingEntry.content.length > 50 
                            ? pendingMove.existingEntry.content.substring(0, 50) + '...'
                            : pendingMove.existingEntry.content)
                        : 'ë‚´ìš© ì—†ìŒ'}
                    </div>
                  </div>
                </div>
                <div style={{
                  padding: '16px',
                  backgroundColor: '#f0fdf4',
                  borderRadius: '8px',
                  border: '1px solid #bbf7d0'
                }}>
                  <div style={{ fontSize: '12px', color: '#16a34a', fontWeight: 'bold', marginBottom: '8px' }}>
                    ìƒˆë¡œìš´ ë°ì´í„°
                  </div>
                  <div style={{ fontSize: '11px', color: '#666', lineHeight: '1.4' }}>
                    <div style={{ marginBottom: '4px' }}>
                      <strong>ì´í•´ë„:</strong> {pendingMove?.draggedEntry?.understanding}ì 
                    </div>
                    <div style={{ marginBottom: '4px' }}>
                      <strong>ë§Œì¡±ë„:</strong> {pendingMove?.draggedEntry?.satisfaction}ì 
                    </div>
                    {pendingMove?.draggedEntry?.keyword && (
                      <div style={{ marginBottom: '4px' }}>
                        <strong>í‚¤ì›Œë“œ:</strong> {pendingMove.draggedEntry.keyword}
                      </div>
                    )}
                    <div style={{ 
                      marginTop: '6px',
                      padding: '4px 6px',
                      backgroundColor: 'rgba(255,255,255,0.7)',
                      borderRadius: '4px',
                      fontSize: '10px'
                    }}>
                      <strong>ë‚´ìš©:</strong> {pendingMove?.draggedEntry?.content 
                        ? (pendingMove.draggedEntry.content.length > 50 
                            ? pendingMove.draggedEntry.content.substring(0, 50) + '...'
                            : pendingMove.draggedEntry.content)
                        : 'ë‚´ìš© ì—†ìŒ'}
                    </div>
                  </div>
                </div>
              </div>
            )}

            {!pendingMove?.isOverwrite && (
              <div style={{
                padding: '20px',
                backgroundColor: '#f0f8ff',
                borderRadius: '12px',
                border: '2px solid #3b82f6',
                marginBottom: '16px',
                textAlign: 'center'
              }}>
                <div style={{ marginBottom: '12px', display: 'flex', alignItems: 'center', justifyContent: 'center', gap: '8px' }}>
                  <img src="/lv11.png" alt="preview" style={{ width: '32px', height: '32px' }} />
                  <span style={{ fontSize: '16px' }}>â¡ï¸</span>
                  <img src="/lv1.png" alt="calendar" style={{ width: '32px', height: '32px' }} />
                </div>
                <div style={{ fontSize: '14px', fontWeight: '600', color: '#1e40af', marginBottom: '8px' }}>
                  ì´ë™í•  ë°ì´í„° ë¯¸ë¦¬ë³´ê¸°
                </div>
                <div style={{ fontSize: '13px', color: '#475569', lineHeight: '1.4' }}>
                  <div style={{ marginBottom: '6px' }}>
                    ğŸŸ¢ <strong>ì´í•´ë„:</strong> {pendingMove?.draggedEntry?.understanding}ì  |  
                    â¤ï¸ <strong>ë§Œì¡±ë„:</strong> {pendingMove?.draggedEntry?.satisfaction}ì 
                  </div>
                  {pendingMove?.draggedEntry?.keyword && (
                    <div style={{ marginBottom: '6px' }}>
                      ğŸ”‘ <strong>í‚¤ì›Œë“œ:</strong> {pendingMove?.draggedEntry?.keyword}
                    </div>
                  )}
                  <div style={{ 
                    marginTop: '8px',
                    padding: '8px 12px',
                    backgroundColor: 'rgba(255,255,255,0.8)',
                    borderRadius: '6px',
                    fontSize: '12px',
                    border: '1px solid #bfdbfe'
                  }}>
                    <div style={{ display: 'flex', alignItems: 'flex-start', gap: '6px' }}>
                      <img src="/lv6.png" alt="content" style={{ width: '12px', height: '12px', marginTop: '1px' }} />
                      <span><strong>ë‚´ìš©:</strong> {pendingMove?.draggedEntry?.content 
                        ? (pendingMove?.draggedEntry?.content.length > 60 
                            ? pendingMove?.draggedEntry?.content.substring(0, 60) + '...'
                            : pendingMove?.draggedEntry?.content)
                      : 'ë‚´ìš© ì—†ìŒ'}</span>
                    </div>
                </div>
              </div>
            )}

            <div style={{ display: 'flex', gap: '12px' }}>
              <button
                onClick={cancelMove}
                style={{
                  flex: 1,
                  padding: '12px',
                  backgroundColor: '#f3f4f6',
                  color: '#374151',
                  border: 'none',
                  borderRadius: '8px',
                  fontSize: '14px',
                  fontWeight: '600',
                  cursor: 'pointer'
                }}
              >
                ì·¨ì†Œ
              </button>
              <button
                onClick={confirmMove}
                style={{
                  flex: 1,
                  padding: '12px',
                  backgroundColor: pendingMove?.isOverwrite ? '#ef4444' : '#3b82f6',
                  color: 'white',
                  border: 'none',
                  borderRadius: '8px',
                  fontSize: '14px',
                  fontWeight: '600',
                  cursor: 'pointer'
                }}
              >
                {pendingMove?.isOverwrite ? 'ë®ì–´ì“°ê¸°' : 'ì´ë™í•˜ê¸°'}
              </button>
            </div>
          </div>
        </div>
      </div>
      </div>
      )}
    </>
  );
};

export default LearningJournalViewModal;